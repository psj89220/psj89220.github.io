---
date: 2020-10-21 14:37:37
layout: post
title: Keycloak 커스텀 테마 개발 - 2부
subtitle: Keycloak은 나의 원수
description: Keycloak 커스텀 테마 개발
category: css
tags:
  - keycloak
  - keycloak spi
  - keycloak custom theme
author: A
paginate: true
---
회원가입 페이지 커스텀

Keycloak에서 기본적으로 제공하는 기능, 모듈만으로 많은 상황을 커버할 수 있긴 하지만, 요구사항에 따라 커스텀 모듈을 개발해야할 때가 있다. SPI(Service Provider Interface)를 개발하기 위해서는 세가지 요소를 정의하여 Keycloak 서버에 등록해야한다.

1. ProviderFactory

   개발하려는 모듈의 종류에 따라 다른 ProviderFactory를 implementation해야함. implementation시 ServerInfoAwareProviderFactory도 implementation 후 getOprationalInfo() 메서드를 overriding하면 등록된 모듈의 기본정보를 Keycloak Admin Console에서 확인할 수 있다.
2. Provider
3. Configuration File

   Keycloak 경로 내 standalone.xml, standalone-ha.xml 혹은 domain.xml 파일(Keycloak이 구동되고 있는 방식에 따라 다른 파일에 정의해야함)에 Provider에 대한 프로퍼티를 정의할 수 있다. Provider 내에서 해당 프로퍼티는 init(Config.Scope config) 메소드 내에서 가져와 사용할 수 있다.

개발한 모듈을 등록하는 방법은 두가지가 있다

1. Keycloak Deployer사용

   개발한 Provider를 컴파일한 jar파일을 Keycloak 경로 내 deploy 폴더에 넣게 되면 자동적으로 배포된다. keycloak에서 권장하는 방법이며, hot deploy를 지원하기 때문에 편리하다
2. Module로 배포

   `KEYCLOAK_HOME/bin/jboss-cli.sh --command="module add --name=org.keycloak.examples.event-sysout --resources=target/event-listener-sysout-example.jar --dependencies=org.keycloak.keycloak-core,org.keycloak.keycloak-server-spi,org.keycloak.keycloak-events-api"`

Authentication SPI 개발

다시 회원가입으로 돌아가서, 회원가입 페이지를 커스텀할 시 회원가입에 필요한 어트리뷰트(이메일, 이름 등) 에 대한 커스터마이징을 하기 위해서는 Custom Authentication SPI 모듈을 개발해야한다.